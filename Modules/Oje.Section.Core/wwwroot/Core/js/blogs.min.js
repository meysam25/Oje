function initBlogPage(){initBlogDropdown();initBlogCategoryButtons();$(".loadMoreButton").click(function(){doSearch(!0)});doSearch();onBlogScroll()}function onBlogScroll(){var foundObj=$("#scrollDtectorForBlog"),handler;if(foundObj.length!=0){handler=onVisibilityChange(foundObj,function(currVisible){currVisible==!0&&($(".holderBlogItems").addClass("holderBlogItemsActive"),setTimeout(function(){$(".holderBlogItems").css("max-height","unset")},600))}.bind({curThis:foundObj}));setTimeout(function(){handler(foundObj)},50);$(window).on("DOMContentLoaded load resize scroll",handler)}}function initBlogCategoryButtons(){var querySelector=$(".holderCats");querySelector.length==1&&postForm("/Blog/Blog/GetCategories",new FormData,function(res){var result="",i;if(res&&res.length>0)for(i=0;i<res.length;i++)result+=getBlogCatTemplate(res[i]);querySelector.html(result);initBlogCategoryButtonInitFunctions(querySelector);doSearch()},null,function(){})}function getBlogCatTemplate(catItem){var result="";return catItem&&catItem.id&&catItem.title&&(result+='<a data-id="'+catItem.id+'" class="blogCatButton  '+(catItem.id==Number.parseInt(catId)?"mainBtn":"secountBtn")+' ">'+catItem.title+'<input type="hidden" name="catIds" value="'+(catItem.id==Number.parseInt(catId)?catItem.id:"")+'" /><\/a>'),result}function initBlogCategoryButtonInitFunctions(querySelector){querySelector.find(".blogCatButton").click(function(){movePaginationToFist();$(this).hasClass("secountBtn")?($(this).removeClass("secountBtn").addClass("mainBtn"),$(this).find("input").val($(this).attr("data-id"))):($(this).removeClass("mainBtn").addClass("secountBtn"),$(this).find("input").val(""));doSearch()})}function movePaginationToFist(){mobilePage=1;$(".page-item.active").removeClass("active");$(".page-item").find('a[data-value="1"]').closest(".page-item").addClass("active")}function showBlogLoaders(){showLoader($("#blogContainer .blogSearch"));showLoader($("#blogContainer .blogItemsSection"))}function hideBlogLoaders(){hideLoader($("#blogContainer .blogSearch"));hideLoader($("#blogContainer .blogItemsSection"))}function getCurrPage(qureSelector){var result=1;return result=Number.parseInt(qureSelector.find(".active a").attr("data-value")),isNaN(result)&&(result=1),result}function filltempArrayForPagination(cPage,pageCount){for(var pages=[],offset=2,i=1;i<=pageCount;i++)(i==pageCount||i==1||i==cPage||i>cPage&&i<=cPage+offset&&i<=pageCount||i<cPage&&i>=cPage-offset&&i>=1||cPage-(offset+1)<=0&&i<=cPage+1+offset-(cPage-(offset+1))||cPage+offset+1>pageCount&&i>cPage-1-offset-(cPage+offset+1-pageCount))&&pages.push(i);return pages.length>=2&&pages[1]-pages[0]>1&&(pages[1]="..."),pages.length>=2&&pages[pages.length-1]-pages[pages.length-2]>1&&(pages[pages.length-2]="..."),pages}function updateBlogPagination(pageCount){var qureSelector=$(".holderPagination"),result,cPage,tempArr,i;if(pageCount>1){for(result='<ul class="pagination">',cPage=getCurrPage(qureSelector),result+='<li class="page-item pMovePrev  '+(cPage==1?"disabled":"")+' "><a class="page-link" href="#">قبلی<\/a><\/li>',tempArr=filltempArrayForPagination(cPage,pageCount),i=0;i<tempArr.length;i++)result+='<li  class="page-item '+(cPage==tempArr[i]?"active":"")+" "+("..."==tempArr[i]?"disabled":"")+'"><a data-value="'+tempArr[i]+'" class="page-link" href="#">'+tempArr[i]+"<\/a><\/li>";result+='<li class="page-item pMoveNext '+(cPage==pageCount?"disabled":"")+'"><a class="page-link" href="#">بعدی<\/a><\/li>';result+="<\/ul>";qureSelector.html(result);initBlogPageClickEvent(qureSelector)}else qureSelector.html("")}function initBlogPageClickEvent(holderQuery){holderQuery.find(".page-item a").click(function(e){var targetObj;if(e.stopPropagation(),e.preventDefault(),!$(this).closest(".page-item").hasClass("disabled"))return $(this).closest(".page-item").hasClass("pMovePrev")?(targetObj=$(this).closest(".pagination").find(".active").prev(),$(this).closest(".pagination").find(".active").removeClass("active"),targetObj.addClass("active")):$(this).closest(".page-item").hasClass("pMoveNext")?(targetObj=$(this).closest(".pagination").find(".active").next(),$(this).closest(".pagination").find(".active").removeClass("active"),targetObj.addClass("active")):($(this).closest(".pagination").find(".active").removeClass("active"),$(this).closest(".page-item").addClass("active")),doSearch(),!1})}function getBlogItemTemplate(blogItem){return`
    <div class="BlogItem">
        <a href="${blogItem.url}" title="${blogItem.title}" class="BlogItemHolderImage">
            <i class="BlogItemCat">${blogItem.catTitle}</i>
            <span></span>
            <img width="285" height="200" alt="${blogItem.title}" data-src="${blogItem.src}" />
            <i class="blogItemFav">${blogItem.fCount}</i>
            <i class="blogItemCom">${blogItem.mCount}</i>
        </a>
        <div class="BlogItemHolderTitle">
            <a title="${blogItem.title}" href="${blogItem.url}">${blogItem.title}</a>
        </div>
        <div class="BlogItemDescription">
            ${blogItem.summery}
        </div>
        <div class="blogOwnerAndTime">
            <div>${blogItem.createUserFullname}</div><div>
                <img alt="تاریخ ایجاد" width="16" height="16" src="/Modules/Assets/Blogs/clock.svg" />
                ${blogItem.createDate}
            </div>
        </div>
    </div>
`}function doSearch(mobileV){var postParams=getFormData($("#blogContainer"));mobileV?(mobilePage++,postParams.append("page",mobilePage)):postParams.append("page",getCurrPage($(".holderPagination")));window.keyWordId&&postParams.append("keyWordId",keyWordId);showBlogLoaders();postForm("/Blog/Blog/Search",postParams,function(res){var result,i;if(res&&res.data&&res.data.length>0){for(result="",i=0;i<res.data.length;i++)result+=getBlogItemTemplate(res.data[i]);$(".blogSearchSummery").find("strong").html(res.total);mobileV?$(".holderBlogItems").append(result):$(".holderBlogItems").html(result);$(".holderBlogItems [data-src]").loadImageOnScroll();updateBlogPagination(res.pageCount);res.pageCount<=mobilePage?$(".loadMoreButton").css("display","none"):$(".loadMoreButton").css("display","block")}else mobileV||$(".holderBlogItems").html('<div style="line-height:200px;" >اطلاعاتی یافت نشد<\/div>')},null,function(){hideBlogLoaders()})}function initBlogDropdown(){$("#holderDropdownType").html(getDropdownCTRLTemplate({parentCL:"col-xl-4 col-lg-4 col-md-3 col-sm-6 col-xs-12",name:"typeId",type:"dropDown",textfield:"title",valuefield:"id",dataurl:"/Core/BaseData/Get/BlogTypes",label:"نوع"}));$("#holderDropdownType").find("select").change(function(){movePaginationToFist();doSearch()});$("#holderDropdownSort").html(getDropdownCTRLTemplate({parentCL:"col-xl-4 col-lg-4 col-md-3 col-sm-6 col-xs-12",name:"sortID",type:"dropDown",textfield:"title",valuefield:"id",dataurl:"/Core/BaseData/Get/BlogSortTypes",label:"مرتب سازی"}));$("#holderDropdownSort").find("select").change(function(){movePaginationToFist();doSearch()});executeArrFunctions()}var mobilePage=1;initBlogPage();